<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 4 - Printing Department Visualization</title>
    <link rel="stylesheet" href="visualization-styles.css">
    <style>
        /* Day 4 Specific Styles */

        .grid-container {
            background: #2c3e50;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
            overflow: auto;
        }

        .grid {
            display: inline-grid;
            gap: 1px;
            background: #34495e;
            padding: 2px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 6px;
            line-height: 1;
        }

        .cell {
            width: 6px;
            height: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .cell.empty {
            background: #1a1a1a;
        }

        .cell.roll {
            background: #95a5a6;
        }

        .cell.accessible {
            background: #3498db;
            box-shadow: 0 0 3px rgba(52, 152, 219, 0.8);
        }

        .cell.removing {
            background: #e74c3c;
            animation: removeAnim 0.5s ease-in-out;
        }

        .cell.removed {
            background: #1a1a1a;
        }

        @keyframes removeAnim {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.5); background: #f39c12; }
        }

        .legend {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .info-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            font-size: 0.95em;
            color: #555;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìÑ Day 4: Printing Department</h1>
        <p class="subtitle">Paper Roll Accessibility Visualization</p>

        <div class="mode-toggle">
            <button class="active" onclick="setMode('part1')">Part 1: Count Accessible</button>
            <button onclick="setMode('part2')">Part 2: Iterative Removal</button>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #95a5a6;"></div>
                <span>Paper Roll</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #3498db;"></div>
                <span>Accessible (< 4 adjacent)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #e74c3c;"></div>
                <span>Being Removed</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #1a1a1a;"></div>
                <span>Empty Space</span>
            </div>
        </div>

        <div class="info-panel" id="infoPanel">
            Click "Run Algorithm" to start visualization
        </div>

        <div class="grid-container">
            <div class="grid" id="grid"></div>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-label">Grid Size</div>
                <div class="stat-value" id="gridSize">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Rolls</div>
                <div class="stat-value" id="totalRolls">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Accessible Rolls</div>
                <div class="stat-value" id="accessibleCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Removal Round</div>
                <div class="stat-value" id="roundNumber">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Removed</div>
                <div class="stat-value" id="totalRemoved">0</div>
            </div>
        </div>

        <div class="speed-control">
            <label for="speedSlider">Speed:</label>
            <input type="range" id="speedSlider" min="1" max="10" value="5">
            <span id="speedLabel">‚óè‚óè‚óè‚óè‚óè</span>
        </div>

        <div class="controls">
            <button class="btn-primary" onclick="runAlgorithm()">‚ñ∂ Run Algorithm</button>
            <button class="btn-secondary" onclick="reset()">‚ü≤ Reset</button>
        </div>
    </div>

    <script>
        // Actual puzzle input
        const PUZZLE_INPUT = `@@@@@.@@@.@.@.@.@.@@@.@..@.@@@@.....@@.@.@@..@@@..@@@@@@@@..@@@.@.@..@..@.@..@@.@@@@@@@@.@@.@@.@@@@@@.@@@..@..@@@@@.@@@@@@@@@@@@@@@@.@@@..
.@@@@.@..@@..@@@..@@..@....@@@.@@@@@@@@..@@@@@@@.@@...@.@@..@@@@..@..@...@.@@@..@..@@.@.@@..@..@.@@@.@.@@@.@@..@.@@@@@@@.@@.@@.@@@.@..@@@@
@..@..@@..@@..@@@.@.@@.....@@@@@.@@..@@@@@.@@@@@@..@.@@.@@@@.@@...@@..@@@@@@@.@.@@@@.@.@@@@@@.@@@.@@@@.@..@@@.@@@@@@...@@..@@@..@.@@.@@@..
@@@.@.@@@@@@@.@..@.@@@.@..@.@@..@@@@.@@@@@.@.@@@.@@@@.@@@.@@@@@..@@@@.@@..@..@@@@@@.@@.@@.@@..@.@@@@@@@@.@@@@.@..@.@@.@...@@@.@..@.@@@@@@@
@@@@@@.@..@..@...@.....@.@@@@@.@@.@@@@@..@@.@@.@@.@.@@@.@@@@.@@@@.@@@@@@@.@@.@@.@..@@..@.@..@.@@.@@@@@@@@.@@.@@..@@.@@..@@@@@@@@@@@.@@@@..
.@@@@@@...@@@.@@@@.@@@@...@.@@@..@@@@@@.@@@@..@.@.@@.@..@.@@@.@.@..@.@@.@@@@..@.@.@..@@@@@@@@@..@.@.@@@@@@.@.@@.@.@....@@@@..@.@@...@@@@@@
.@@.@@@.@@.@@@.@....@@@@@@@@@@.....@..@..@.@.@@@@@..@@.@.@....@@.......@.@@@@..@@@@.@@.@@@@@@@.@..@.@@@.....@.@...@@@@.@@@..@.@@@.@@.@@@@.
@@@.@@.@.@@@@.@..@@.@.@@.@.@@.@@@.@...@@@@@@..@@.@.@...@.@@.@@......@@.@@@@.@.@@@@.@..@@@.@..@@@@@@.@..@..@.@.@@@@.@@@@@@@@.@@@@.@.@...@.@
.@@@@@@.@.@@.@@@@@@.@.@..@..@@@@.@@.@.@..@@.@@..@.@..@@@..@@@.@.@@@.@@.@.@@@...@...@...@@@@@@@@@@@.@@.@@..@@@..@@.@@@.@@.@.@.@@@@@@@@.@..@
@@.@@@@@.@@@...@@.@@..@..@.@@@@@@.@@@@@@@..@@@..@.@@@@@@@..@.@.@@@...@.@@@@@@@@@.@@.@@@@@@...@.@@..@@@.@.@@@@@.@.@@...@@@@@.@@..@@@.@@@...
.@..@@@@..@@.@.@@@@.@@.....@@@..@@@@.@@.@.@.@@@@@..@.@..@@.@@.@..@@@@@@.@@@@@..@.@@@@.@@@.@@@@.@@..@@....@@@@@@@@.@@.@@@@.@@...@@@@@@@.@@@
@.@@...@@.@..@@@.@@@...@@@.....@@@@@@@..@@@@.@....@..@@@@.@....@@.@@..@.@@@@.@@..@@.@@..@@@@..@@@@@@@@@@@.@@..@..@@..@@.@@@@.@@.@.@...@..@
.@@.@..@@.@@.@@.@@@@@@@@.@.@@@@.@@@.@@....@@@@.@@.@..@.@@@@@@@@..@@@@.@@@@.@.@@.@@..@.....@@@.@@@@.@@@@.@@@.@@..@@@@@@@@..@@@.@...@@@@.@@@
@.@...@@@@@.@..@@...@@..@@@@@@..@@@@@@@.@@@@.@@..@@.@@.@@@@..@@.@@@@.@.@@@.@@.@@..@@@@@@@@@.@...@@.@.@.@@...@..@@@@.@@.@@@@@@@@.@...@@@.@@
.@@..@@@.@@.@@.@.@..@@.@@.@@@.@@@...@.@@..@@@..@.@@@@@...@..@@@@@@.@.@.@.@@@@@.@.@@@@@@@@@@@@@..@@.@@@@@@@@@@...@@.@@.@@.@@@....@@@@.@@@.@
@@.@..@@@@@@@@.@@.@@@...@.@..@.@@.@@@@.@@@@@@@.@@@@.@@@@.@@@@@@@.@.@@@@@.@@.@..@@..@....@@@@.@@@...@@@.@@.@....@.@@@.@@@.@..@@@@.@@@@.@.@.
@@@..@@@@.@@@@@@.@..@..@@@@@@@@@@@..@@@@.@..@@@@....@@.@@.@@@@@.@@@..@.@@.@..@..@..@@.@.@@@.@@@@@.@@@@@@@@@.@.@@..@@@...@..@.@@....@@...@.
@.@@@@.@@.@.....@@@@.@..@@@@..@@..@.@@@@@.@@.@@@.@...@.@........@@@@.@@@@@@.@.@@@...@@@@@@@@.@@...@@..@....@.@@..@.@@@@@...@..@@.@@@.@.@@@
@@...@@@@@.@.@@@@@@@.@@@@@@.....@.@@@@@@..@@@@@@@@@@@@.@@@.@@@@@@@@@..@.@@.@@.@@@.@.@......@@@.@@@@..@..@@.@.@@@@@...@@.@@@@@@@@@@@.@@..@.
@@.@@@.@@@@@.@@@@@@.@.@@..@....@.@@@.@@@@@@@@@..@@@@.@@@@@..@..@@.@@@@.@..@@@.@@@@@@@@@.@@@.@.@@@.@@@@@@@..@@.@....@.@@@....@@@@@..@.@@@@@
@@@@.@@@@@..@@@@......@@@....@@@@@.@..@@.@@@@.@@@.@@@@.@..@.@@@@.@@.@@@.@@@@@@@.@@.@@@@@.@@@.@..@@@@..@@@...@@@@@..@.@...@@@.@.@@@@.@@.@@@
@@.@@@.@.@.@@.@@..@.@...@@@.@...@...@@@.....@@@@.@@@@.@@@@@.@..@@@.@.@@@.@@@.@....@@@@@.@@@@@.@@@.@..@@@@@@@.@...@@@@@@@@.@@@@@@@.@.@@@@.@
.@..@@.@.@@.@@@@@@@..@.@@@@@.@@@@@@@@@@@.@.@.@@@@@@@@@@@.@@.@@@..@..@@@..@@@@@@@.@@@.@@.@@..@..@@@@.@.@@@@@@.@.@.....@.@@@@..@@@.@@@.@@@@@
@.@@@@.@.@@...@@@@.@@.@@@@@@@.@@@..@@.@@@@@.@..@@@@@@@@@.@.@@@..@.@@@@.@@@@@@@@@..@@.@@@@.@.@@.@@.@.@@@@@..@@@..@@@.....@..@@@.@......@@@.
@@@@@@..@@..@..@..@..@.@...@@.@@@@@.@@..@@.@@@@@.@..@@@.@.@.@.@@@.@@@@..@@.@@@@@@.@.@@..@@@@..@@@@@@.@.@.@.@@.@.@@@.@@.@@.@@@@..@.@@@@@@.@
@@.@@..@@.@..@@...@@@@@@@.@@@@@@....@@@@.@@@@@..@@@...@@@@....@.@.@@@@@....@@@@@@@.@@@@@...@@.@@..@@@.@@@@....@.@@@@..@.@....@@@@..@@@@.@.
@.@.@@@@.@@@@@.@.@@@@@@@.@@@@@..@@@..@@@.@@@@@@..@.@@@@@@@@.@@.@@.@@@@@@@@@.@.@@.@@.@.@@..@@.@@@@@@@@@..@@@@..@.@@..@.@.@@@..@...@.@@@@.@.
@....@..@.@..@@@@@@.@..@.@@@.@.@@.@@@.@@.@@@@..@.@@@@@@....@...@@@@@..@.@@@@@.@.@.@.@@@..@.@..@@@.@@@.@@@.@@..@.@@@@@.@@@@@@@.@@@@.@..@@@@
@.@@.@@.@@@@...@@@@@@@.@@.@@@@@....@@@..@@.@@@.@@.@..@.@.@..@@@.@.@.@...@@@@@.....@.@@..@@@@@..@@.@@.@@@@..@@@@.@@.@@@.@.@@@.@@@.@@@@@@@@.
@@@...@..@@@@..@@.@.@@..@.@@...@@@@@@@.@@.@@@.@@.@..@.@@..@@@@@@@@@@@.@@@@.@@.@@@@@@@.@..@@@.@@@@..@@...@..@.@@@.@@@@.@@@@@@@@.@....@@.@@@
@@.@.@.@@@@.@.@@@.@.@..@@@.@.@@@.@.@@.@..@@@@@@@.@@.@@.@@@.....@@@@@@@@@@@@@.@.@..@.@@@@.@.@.@@@@@@@..@@@@.@@.@@.@@.@.@.@@@@..@.@....@@@@.
..@.@@@@@.@@.@.@@@@@@@@@@@@@@@@.@@@@@.@@@.@@@@....@..@@..@@@@@@@@@@@@@.@@@.....@.@@.@@@@..@@@@@.@@..@..@@.@@.@..@..@.@@@@@@@@.@..@@@..@@@@
@..@@@@@@.@@@@@@@@@.@..@.@.@..@@...@@@.@@@.@@@@.@.@@@@@@@@.@.@@..@@@.@@.@@@@@.@.@@@.@.@@.@@@@@.@@.@@@@@@@.@@@@....@@@...@.@.@..@...@@@@@@@
.@@@@...@.@@.@.@@@@@@@.@@.@@@.@@@@@@@.@@@@....@@..@.@@@.@@@@@@.@@.@@@@@@@..@.@@.@@@...@.@@.@.@@.@@@@.@@@@..@@.@@@@@.@@@@.@.@@@..@@@@@.@@.@
@.@@@@......@..@@@@.@@..@@.@@...@.@.@@@@@...@@@@@.@@@@@@...@@.@@.@@@@.@@.@@..@....@.@@@.@@.@.@@.@@@@@@.@.@@@@@@@@.@@.@@@.@.@@@.@@..@@.@@@@
@.@@@@@@@@..@@....@@@@@@.@@@.@@.@@@@@@...@@@.@.@@@@.@.@@@@@@@@.@.@@@@@@@@@..@@@.@@@.@@.@.@@@@@@@@@...@@......@@@@@@...@@.@@@@.@.@@..@@.@..
.@@@.@@..@@@.@@@@@@..@.@@.@@@@..@@.@.@@.@.@@.@.@@@@.@.@.@@@@@..@.@.@@@.@.@@@@.@@.@...@@.@@@@@@@@@@@.@.@@@@..@@@@@@@@@.@@@@@@@....@@@@..@.@
.@@.@@@@.@@@@@@@.@.@@@..@@@@@@....@@@@@@.@.@@@@.@.@@@@..@@@..@..@@.@@.@@@.....@@@@@.@@@..@@.@@@@.@@.@@.@@.@@.@.@@@@@@.@@@@@@@@@@@@@@@..@.@
.@..@@@@......@.@.@.@@@@@.@@@@@...@..@.@..@@..@@@@.@..@@..@.@..@@@.....@@.@.@@.@.@.@@....@..@.@.@@..@@@@@@.@.@.@@@.@@.@@@@.@.@@..@@@@@@@@@
@.@@@@..@@@@@.@@@@@@.@@@@@@...@@@@.@@@@@..@.@@@...@.@.@@@@@@.@..@@.@@@@@.@@.@....@@@.@@@.@.@.@@@@..@@.@@@@@@@.@@@@@@@....@@@@@@@@@@@...@@.
@.@@@@@.@.@@@@.@@@.@@..@@@.@@..@..@@..@@..@@@@@@@.@.@@@....@@.@.@@.@@@@@.@.@.@@.@@@@...@.@@@@.@@.@@@.@.@@.@@@@@.@@.@..@.@..@..@..@@..@@@@.
.@@.@@@@@@@@@@.@@@.@.@@@.@@.@.@@@@.@@@@.@@@.@@@@@.@@@@.@@...@@@@@.@@@...@@@@@@@@@.@@@@@...@@.@@@.@@@@@@.@@@.@.@.@@@@.....@.@@@.@@.@.....@@
.@@.@@.@@@@@@...@...@.@@.@@@@.@@@...@@.@@@@.@.@.@..@@.@.@@.@@.@@@@.@@@.@.@@@.@@@@@@@@.@@@@@.@@@@@@@@.@@@.@.@@...@....@...@.@@.@..@@@.@....
@.@.@.@@.@@@.@@@@@.@.@@....@@@@@@@@@.@@@@..@.@@..@@...@@.@@@.@@@.@@@@@@@@.@..@@.@@..@.@..@.@.@.@@.@@.@@@..@@@@....@@@@.@@@@@@.@@@@@...@.@@
@@@.@.@@@@.@.@@.@.@@.@@...@@....@@@@@@@@.@@@.@@@.@.@@@.@.@@@@@@@.@@.@.@@...@@@@.@@@@@@@@.@@@@..@@@.@@@@@......@@...@..@..@..@.@@@@@..@@..@
@@.@..@@@@@@.@@@@@.@@@@@.@.@@@@@@..@.@.@@@@.@@@@@@@@@@@@@.@.@@.@@@@..@@.@....@.@@@@@@.@@@@@@.@...@@.@.@@.@@..@@@..@@@....@@@@@.@...@..@.@@
@..@@.@@@..@.@..@.@.@.@@@.@..@@@..@@..@..@...@.@@@.@@@.@@@@.@@.@..@@@@@@@@..@..@.@@.@@.@@..@@....@...@.@@..@@@@@@..@@@@.....@@@@.@@@@@@.@.
@@@@@.@@@.@@@@.@@@..@@@@@@@@@@@@@.@@@@@@.@.@@.@.@.@@@@@.@.@@@.@@.@...@@..@.@@.@.@...@@..@@.@@@@@@.@@.@@@...@@@..@@@.@@.@@@.@..@@.@.@.@.@@@
@.@@@..@@.@@.@@@@@....@@@@.@@.@....@@.@@@@..@...@@@@.@@.@@@@.@@@@@...@@@.@@@@@@@@@..@@..@@@.@@@@@..@..@@@@@..@@@@@@@@.@..@...@@@@.@@@.....
...@@...@@.@.@@.@@@.@@@@@@@@.@@..@@@.@..@..@@@.@.@@.@@.@@.@..@@@@@.@@@@@@@@@@@@@@@@@.@.@@@..@.@.@...@.@@@..@.@..@@@@..@..@..@.@@@@.@@.@@.@
@..@@.@@@@..@@@@@@@@@@@@@@@@.@..@@@.@.@@@@.@.@@@..@...@@@..@@.@@..@@@.@@@@..@.@@@@.@@.@@.@.@.@@.@@@@@@..@@..@@.@.@.@..@@...@@@@..@@@@@...@
@....@@@@.@@@@@@@@@@@@@.@.@@@@@@..@.@@@@@@.@@.@@@.@@@@.@.@@@.@@@@@@@@.@.@@@...@@@@@@.@@@.@@@@@@@@@@...@...@.@@@@@@@@.@.@@@..@.@@.@@@@.@@.@
.@@......@.@@.@.@@.@.@.@.@...@@..@@@@.@.@.@..@@@@@.@..@@.@.@.@@@@@.@.@@..@.@@@@@.@..@@@@@@@@@@@.@@@.@@@@@.@@.@.@@.@@@@@@....@@@@@@...@@@@.
...@@@@.@.@@@@@@@@..@@..@@@@@..@.@@@.@..@@@.@@@.@@@@@@..@.@@@@...@.@@..@.....@@@@..@@@.@.@@@@.@@@@.@@..@@..@@@@@@@@@@@.@@@@...@@@.@@@@@@@@
@@@@..@..@..@@@@.@...@@@.@@@.@@@@.@@@@.@@@.@@@..@.@.@..@@@@@...@...@.@@@@.@..@@@@@@@.@@.@..@@@.@@.@@.@@@.@@.@@@@@@.@@@@..@.@...@@@..@@.@@@
..@.@@@@..@@.@@....@.@.@@@@.@.@.@@@@@@@...@..@@.@..@.@@.@@@@@@...@@..@@@@@@@@..@.@.@@@@@..@.@@@@......@...@@@@..@@@@.@.@@@@@@.@@@.@..@@@.@
@@.@.@.....@@..@@@@...@@@.@@@@@.@@@@@@@@.@@.@..@.@....@@@@@.@...@.@..@@@@@@@.@@..@...@..@.@.@@@.....@@@@@.@.@.@.@@@.@@.@.@.@@@@@.@.@.@@..@
@...@@@@..@@..@@@@@@@.@@@.@@@.@.@@@@@@@@@@@.@.@@@.@@@@.@@@@@@@@@.@@@@@@@@@.@..@.@@@@@@@..@.@@@@@..@@@@@@..@@@..@@@@@@.@@@@@@@@.@@.@@.@@.@@
@@..@.@@@...@@@@.@@.@@@@.@@@..@@.@@...@@..@@..@@@@.@@@.@@..@@..@@@.@..@@@...@@.@@@..@@@..@.@.@@@@@@@@@@@@@..@@@@@@..@..@@.@@@@.@@@@@@.@.@@
@..@..@@.@@.@@....@.@.@@@@@@@@@@@@@@@.@..@@..@@.@.@@..@@@.@@.@.@@.@@@@@@@@@..@@.@@.@@.@.@.@@..@@@@@@@@@@@..@.@@@@@@..@..@@@@@@.@@@.@@@.@@@
@@@@.@@@@@@.@@@@@.@@..@.@@..@@@@@..@@..@@@.@@.@.@@@@..@@@@@@.@@@....@..@.@...@@@@@@@@@..@@.@@..@.@@@@@.@.@@.@@@.@.@.@.@@@@@@..@@.@@@.@@@@@
@@@@.@@..@..@.@@@@@...@@..@.@@.@@@@.@@@@.@@@.@....@@@...@.@@.@@.@..@@@@@....@@.@...@@.@.@@.@..@..@@@...@.@@.@@.@@.@.@.@@@.@@....@@@.@.@.@@
@.@@.@@.@@@@@@@@.@@@@@@@@@@.@@.@.@@@@@@.@.@..@.@@..@@@@...@@..@@@...@..@@..@@@.@@.@@@@.@@@.@@@@@@@@@.@@@@@@@..@.@.@@..@...@@@@@.@@@.@@@..@
@.@@@@@@@.@....@@.@.@@.@@@@.@@....@.@...@@@.@@@@.@@......@.@@.@@@.@@@@@..@.@@.@@@.@@.@.@@.@@@..@@.@.@@@@.@@.@..@@.@...@@.@@@@.@@..@.@@.@@@
..@@@@.@..@@@......@@.@@@@@@@@@@@@.@@@.@@@.@@.@.@@@.@@....@.@@.@@@@..@..@@..@@@@@@@@.@.@.@.@@@..@.@.@@@@@@@@@@@.@@@@@..@.@.@@.@@....@@.@@@
.@@@@@....@..@@.@@@....@@..@.@@@.@.@@@@@@.@@@.@@...@...@.@@@@@@.@@.@...@@@@@@@@....@@@@@...@@..@....@..@...@@@..@..@@.@@@.@@@@@@@.@@@@@.@@
@@..@@@.@.@@@.@.@@.@@@@@...@@@@@@@@.@@.@..@.@..@.@.@..@..@@@.@@@.@.@.@@@.@.@.@..@.@@@.@@@@.@@@.@@@@..@@@@@@@@@@@@@....@.@@@@.@@..@@@.@@@..
@.@.@.@@.@@@@@@.@.@@@@@@.@@.@@@@@@@@.@@..@..@@@@..@..@@@.@@.@@@.@@.@.@@@@@.@@@@.@.@@.@@.@.@.@.@@..@@@.@@.@.@..@..@@.@@@@.@@@.@..@@.@@.@@@@
@..@...@@@.@@@.@.@@@@.@@@.@.@@.@.@@@.@.@@..@@.@@@@..@@@@@.@..@.@@@.@.@@@...@@@..@@.@@@@@@@@..@.@..@.@.@@@..@@.@@@.@.@@@.@@...@@.@.@.@@@@@@
@@@@..@@@@@..@@@@@@.....@@@...@.@@@@@...@.@@@@@.@@@..@@..@@@@@.@.@.@.@.@@@@.@@.@@@.@@.@@@..@.@@@.@@.@@@...@@@.@@@@@@.@@@@@@@@@@..@@....@.@
@@@@.@@.@@@.@...@.@.@..@@@@@@@@@@.@@..@..@@@@@@..@@@@@@@@@.@.@@.@@@@@.@@@.@@.@@@@@.@..@@@@@...@..@@@@..@...@..@@@@@.@@...@@@.@@@@.@@.@@.@@
.@..@.@@.@@@@@@@.@@@@@@..@@@@@@@@@..@.....@.@@@@@@@@@@@@@@.@..@....@.@@@@@@@@@@.@@@.@...@.@@.@...@..@.@@....@@@.@..@.@@@@..@@@@.@.@.@...@@
@@@@...@@@..@@..@@@@.@@@@@@@@@..@@.@...@@@@.@.@@@@@..@@@.@..@@.@@@..@@..@@.@@@.@..@@@@@.@.@@..@@..@@@@@@@@@@@@.@@.@@@..@@@@@@.@.@@.@@@.@@@
.@@@...@..@@@@@@.@@@..@@.@@.@@@@.@@@@@@@@@@@@@@@@.@..@@@@.@@..@.@...@..@@@@@@@@@.@@@@@.@@@.@.@@.@@@@@@@@@@.@.@@.@@@...@@@.@@@.@@.@@.@@@@@@
@@@.@..@.@.@@@.@.@.@@@@@..@@@@.@...@.@.@.@..@..@@@...@@@@.@.@@@@@@@@...@.@.@@@@@@.@..@@.@@@..@@.@@.@@...@@@@@@@@@@@@.@@@.@.@@@@@@@@@@@@@@.
@...@..@..@.@@.@..@@...@@@@@.@@@@@@.@@@.@@@.@@.@@@@.@@@@.@..@@@@@@.@@.@@@@@..@@@..@.@.@.@@@..@@@@@.@@.@..@.@@@.@.@@@.....@@@@.@@@.@@@@@@.@
@@.@.@@@@@@.@.@.@.@.@@..@.@@@..@@@@@@@.@@@@@@@@@.@..@@.@@.@@@.@@@@...@@@@..@@..@@.@@@@@@@@@@..@@@@@...@.@@@@.@@.@@@.@.@@@@.@@....@.@@.@@@.
@@@@.@@@@@@@@@@@.@..@@..@@@.@@@@.@.@@..@@.@.@@@.@.@.@@@..@@@@..@.@@@..@@.@.@@@@@.@.@@@@@@@@@.@.@@.@...@....@@.@@.@.@@...@@@.@@@@.@@.@.@.@.
@...@.@@@..@@@@@.@@@@...@..@@..@.@@@@@.@@@@.@@@.@.@@@.@@....@@@@.@@..@.@@@.@@@.@@@..@.@@@@.@@@.@@@@@@.@.@@@@@@@@.@@..@@@@@@@@@@@.@@.@@.@@@
.@@.@..@@@@@@@..@..@@...@.@@@@.@@@@@.@.@@@@@.@.@@.@@.@@.@@@.@@@@@@@@@.@.@.@@@@@@...@@@.@@@..@.@...@.@.@@@@@@@@@@.@.@@@@.@@.@..@@@@@@@.@@@@
@@@.@@..@..@@.@.@.@@@.@@.@@@..@@.@@.@@@.@@.@@.@.@@@@..@@@@@@@@@@@.@..@@@.@.@@@@@@.@@@@@@@@@@..@.@@@@@@@.@@@@.@@@@.@.@@@@@@@@@@@..@@@@@@@@.
@..@.@@@@...@.@..@@..@.@.@.@@@..@@@..@@@.@@@@@.@@@@@.@..@@..@@.@@@@..@....@@@@@@.@@.@@.@..@@.@.@@...@...@@@...@.@@@.@@@@@@.@@@@@..@@...@.@
@@@@@@.@@@@@@@.@.@@@@....@@.@.@@@.@.....@@@.@..@..@@.@.@...@.@@@..@..@@@@...@@...@@@..@..@@.@@@@@.@.@@..@@..@@@@@.@@@@@@@.@@@@@@@.@..@.@@.
@@.@.@.@@@....@@@........@.@@..@....@@.@@..@.@@@@..@@@..@@..@@..@.@@@..@.@@@@@@@.@@@..@..@@@@@@@@.@@@.@@@@.@@@@.@@.@@..@@@@.@@..@.@...@..@
@@.@@@.@....@@@@@@..@.@@.@@@@.@@@@@@@@@@@@@@@@@@.@@@@.@.@.@@@@.@@@...@@@@@@.@@@@@@@.@@@@...@...@@@@@@@..@@.@.@@@@@@.@.@..@@.@@@@@...@..@@.
@@@@@.@@@@@@@@@@@@@.@@@@@@@.@@@..@..@@.....@@@@@@@@..@@@@@.@@@.@.@@@..@@.@@@@@@.@@@@@@@@.@..@@@...@@.@@@@.@@.@@@@.@@@@@...@@@@@@@@@@..@..@
@.@.@@.@@.@..@@@...@@@.@..@..@@@..@@@..@.....@.@@@@@@@@@.@@.@@@.@@.@.@..@.@...@.@@@@..@@..@@@.@.@@@@.@@.@.@.@@@.@..@.@@@@.@@.....@@.@@@.@.
@@@..@..@..@.@@.@@@@@@@.@@@@@@@.@@.@@@.@@.@@@@@@@@@@.@.@@@.@@@..@@..@@@@@@@@.@@@@@@@.@@@@@..@@@@@.@@.@..@.@...@.@@@..@@@..@@.........@@@@@
...@@@@..@@@@.@@..@.@.@....@@@@@.@@@.@.@.@.@@@..@@@@@@@.@.@@@...@.@@.@..@@@@.@.@.@.@@@@@..@@@@@@..@...@@@@@@@@@@@.@@@@.@@..@.@@..@@..@@.@@
@@.@@@.@.@@@.@.@@@@@.@..@@@@@@@@@@.@.@.@@@@.@.@@@.@@@@@@@.@@.@@.@@..@@@@@.@.@@@@@.@..@@@@@.@..@@.@..@..@..@..@@@@...@@@@.@.@..@..@@@@.@@.@
@@@@@.@@.@@@.@@.@@...@.@@@@...@@@.@@@...@@.@@@@@...@@@@@@@@@@.@..@@.@@@.@@.@.@@@.@...@@@.@@..@@@@.@@.@.....@@@..@@@@@@@@@@.@@@@.@@@.@.@.@.
@.@.@.@.@.@..@@@..@.@@.@@.@@.@@..@.@@@.@.@@@@@@@...@@@.@@@@.@.@@.@.@.@.@.@.@@@@..@.@@@@@@@.@@@@.@@..@.@@..@@..@@...@@@.@@@@.@@.@@@..@.@.@.
@@@@@.@@..@.@..@@.@@.@@...@.....@@@@.@@.@@.@@@@@@@@.@.@.@@@.@@@@..@@@@@@@..@@@@.@@..@@@@@@..@@.@@@@@.@.@@.@.@@@@@@....@@....@@.@@@@@@@@.@@
.@@@@@.@@.@.@@@@@..@..@.@@..@@@@@@@@@@@@.@..@@@.@.@@@@@@@@.@@..@.@@.@.@@@@@@@@@.@@.@@@@@@..@.@@@@@.@@.@@.@..@@..@@@.@.@...@...@@@@..@@@.@@
@@@@@.@.@..@...@@@.@@.@@@@@.@...@@@.@@@.@.@...@@@.@@...@@@@.@....@@@@@@@.@..@@@...@.@@..@@@@@.@@@..@@.@@..@.@@..@.@.@@.@.@@@@@@.@.@@@@..@@
@...@@@..@.@@@@@@...@@.@.@@@.@@.@..@@@@.@@.@@@...@..@@@@..@.@..@@@@@@.@.@@@..@.@@.@@@@@@@.@...@@.@..@@@@.@...@.@@@.@@....@@@@..@.@.@@@.@@.
.@..@@@@....@@@@@@@@.@@.@@.@@..@@@@...@@..@@@@@.@@@@..@.@.@@@@@@.@@@@.@.@@.@@@@@@@@@@..@..@....@@...@@.@..@...@@....@@@@..@@@@@.@@@..@@..@
..@@.@.@@.@..@.@@...@@...@@@@.@@@@.@@@@@@@@.@@.@@@..@@@@@@@@@@@.@@@..@.@@.@@.@@.@..@@..@.@@.@.@@.@@.@.@@@.@.@@@@.@@@@.@.@@@@@..@@.@.@@@@.@
@@....@@@@..@@...@@@..@.@@.@@@.@@.@@@@@@@@@.@@@@@@@@@@.@@@@@....@@.@@@@..@.@@@@.@..@@@.@@@.@@@@@....@@@@@..@.@@.@...@.@@.@@@@...@..@@..@@@
.@@@@@@..@@.@...@@@@@@@@.@@...@@@@@.@@@@@@..@..@@@@.@.@@@@@@@@@.@@.@@.@@@.@..@..@..@@@@@@.@.@@@@.@.@@@.@@.@..@@@@.@@@@@.@.@.@@..@@@@@..@@.
.@@@@@@@@@@@@.@@@.@@@@..@@@@@@@..@@@.@.@.....@@.@.@..@.@@@@@.@@.@@.@@@@@@@@.@@@@@.@.@@@@@@..@@.@@@@.@@.@@..@@.@@@@.@@.@@@@.@@.@@@@@.@@..@.
@.@@@@..@...@.@@@@@@@@@@@.@@@@.@@@@..@.@...@@@@@@@.@@@..@@@.@@@@@@....@.....@@@@..@@@@@.@@..@@@@@@@@.@..@...@.@.@.@@@@..@@@.@.@..@@...@@@@
@@@.@@@.@.@@.@.@.@@@@@@@.@@@.@.@@@.@@@.@@...@@@@@@@@@.@@@.@@@@@.@@@@@@@@@@.@@@@@.@@@.@@.@@.@@@@.@@@....@@@@@.@.@@@@@.@@@..@@..@@@@.@@@@..@
@.@..@@@.@@@@@...@.@.@..@@@@.@@@@.@@.@@.@@.@@.@@@.@.@@@.@@.@@.@@@@..@.@@@@@.@@@@@..@.@@@@.@.@.@.@@@@.@@@....@.@.@@..@.@.@@@.@@@@..@@@.@@.@
@@@@@@@..@@@@.@@@@@@@..@.@@@@.@.@@@.@@@@.@..@@@@@@.@@..@@@@@@...@@@@..@@@.@@@@.@@.@@.@.@@@@.@@.@@.@@@@@@.@..@@@.@@@..@@@@@.@@@@@.@@@@@.@.@
....@@.@@..@@.@@..@..@@@.@@.@@@.@.@@@.@@.@.@.@@.@@@@.@@@@@@@@@@@@.@..@.@@@@.@@@@@.@..@.@@..@.@@....@@@@@@@@@@..@@@@@@..@@@@.@.@@@@..@@@@@@
..@@@@.@@@@@@@@@..@@.@.@@.@@@@......@.@@.@@@@@@.@@@..@.@@.@..@@@@@@@@@@@@.@@@.@....@@@.@@@.@@.@@@@.@@@@..@.@.@.@@@@.@@..@@@@.@@..@@@@@@..@
@.@@@@@.@@@@@@.@@...@@.@@@@@@@.@.@@.@@@@@@@.@@@@@@@@@@@..@@@.@@.@@@@...@@@@.@@.@....@..@@@@@@@.@@@@@@@@.@@@.@@@@@@..@@@..@@@@.@..@@.@@@@@@
.....@@@.@@@@@@@@@..@@@@.@@@.@@@@@@@@@@@@...@@@@.@@@.@@@.@@.@.@@@.@@.@@@@@.@.@@@@.@..@@..@..@@@....@@@@.@@@@...@.@...@@.@@@.@@.@..@@@..@@.
@@.@.@..@@.@@.@.@@...@@@..@@@...@.@@.@@@@@..@@.@@@@.@..@.@@@@@@..@@@@@@@@@..@@@@.@@@@@@@@@@@.@@@@.@@@@@.@.@@@.@@@@..@@.@@@@@@@.@.@@@@@.@@@
@@@@.@.@.@.@@@@.@@@@@@@.@@@@.@.@@.@.@@@@.@..@@..@@@...@@@@@..@@@.@@@@@@.@@.@.@@.@..@..@@@.@.@@.@@@.@@@@....@@@@@@@@.@@.@@@@@@@@.@@...@@..@
.@@..@.@@.@..@@@@@@@@..@@@.@@@@@@@@@..@@@.@@..@@@...@.@...@.@@@@@@@@@..@.@.@.@@@@@@....@@@.@@@@...@@@..@@@@@...@@@.@@.@@@@@@@@@.@...@@@@.@
@.@.@@@@.@@.@@.@@@@@@.@@@.@.@@..@.@@.@@@@@@@@@@..@@@@.@@@@...@@.@.@@.@.....@@@..@@..@.@@..@@@.@..@@@@.@.@....@.@@@.@@@@.@..@@@@@.@@@@.@.@@
.@...@@@@@..@..@@.@@@@@.@@@@@@.@..@.@@.@.@.@@@@@..@@@.@@@.@..@......@@.@@@.@@@@@...@..@.@.@@..@..@@@@.@@@@@@.@@@.@@.@@@@@@@@.@..@@@@.@.@.@
.@.......@.@.@@@.@@.@..@.@.@@@.@.@@@@.@...@.@.@....@@....@.@@@@@..@@.@@..@@@@@@.@@.@..@@.@@@.@@..@@@.@@...@@@@@@@@@@.@@@@@@.@@@@@@.@...@@@
@..@@.@@@@@@@@@@.@@@...@.@@@@@@..@@@....@..@..@@....@.@@@..@@....@@@@@@@@.@@....@@.@@@@@.@@..@@@@@......@@...@@@@@@@@.@@@@.@@@@@@.@@.@@.@@
.@..@.@.@@@.@.@@@@@@@@.@@@@@@@@...@@@@@@....@@@@..@@@@.@@.@.@@.@@@.@@@@@@.@@.@@@@@@.@@..@@@.@.@@.@@@@@.@@@.@......@@@@.@@.@@@@@@.@@@@@@@@@
...@@@@.@.@...@@.@.@.....@@@@.@.....@@.@@@..@.@@@@@..@@.@@...@..@@.@@.@.@@..@@@@@.@@.@.@.@@@@@@.@@@@.@...@.@@@@.@@@@..@.@.@@@.@@@@@@@.@.@@
@.@.@..@@.@@.@@@@@..@.@..@.@@@.@@...@@..@@@@@.@@@@@@....@..@..@@.@..@@@@@..@@@.@@.@.@.@@@.@@@@@...@@@.@@..@@@@@..@@.@@@.@@.@@.@...@.@@@.@@
@@....@.@.@.@@@.@@@@@@@@@.@@@.@.@.@@.@@.@..@@@@.@.@.@@..@@@@.@@@@..@..@@@.@@.@...@@@@@@@@@@..@..@..@.@@@@@..@@.@@@.@.@@....@@@@@@@..@@@@@.
@@@..@@@@@@.@@@@@@@..@..@.@@@.@..@@@.@@....@@@@.@.@.@@@.@..@.@.@@@@@@@@@.@@.@...@@@@@@@..@@@@..@@..@@...@@.@..@...@.@.@@.@@.@@@@.@@.@.@...
@@.@.@@@@...@@..@@.@@@@@..@@..@@@.@@@@..@@@@..@@@..@@@..@@@@@@@@@.@@.@@@..@..@@..@@@@.@.@@@@@..@@@@@@....@@@@@@@@@@@..@@..@@@.@@@@@..@@@@.
@@..@@@@@.@@.@@.@@.@@@@@@@.@.@.@@.@@@.@@@.@@@@@.@.@@@@.@@@@@@...@@@@@@@@@@.@@....@@@@..@.@.@@@@@@...@@.@@@.@@@.@..@@@@..@.@.@@.@..@.@@@.@@
....@@@@@@@@@@@@.@@@.@@@@....@@@@@@.@...@@.@.@@@..@@@@..@@@.@..@@@.@.@@@@@@.@...@@@@.@@.@@@@.@@.@@@.@.@.@.@@@@.@@.@.@@@.@@@.@@..@@@.@..@@.
@@@@@@@..@@.@@@@@@.@.@.@@..@@@@@@@.@..@.@@@.@@@..@@.....@@@@..@.@@@@@@.@@@@..@@..@.@@@..@@.@@@.@@@@@@@@@@..@@.@@..@@.@.@@@@@.@@@.@@.@.@.@.
..@@@...@@@@....@@@.@@@@.@.@@@@.@@..@@@.@.@.@.@@...@@@@@..@@@.@@...@@@.@@@@.@.@@@@@@.@@@@@.@@@.@@.@@@@@@.@@....@@@@....@@.@..@@.@@@..@@..@
@...@@@@@@@@@@@.@@@..@@.@.....@@@@@...@@@.@@@...@@@@@..@...@@.@.@....@@.@@@@@@@@.@..@@@@@.@@@@@@.@@@@@@.@@@@@@@..@..@@...@@@@@@@@..@..@@.@
@@@@@...@@@@..@@@.@...@.@@@.@.@@@.@@@@@@@@@@@@.@@.@@@@@@@@@@.@@@.@@@.@@@@.@.@@@.@@@@.@.@@@....@@@@@..@..@@@@@@.@..@@@.@@@...@@.@@.@..@..@@
@@@@@@.@@@@@@@@@@@@@.@@@@@.@.@@@@@@@@.@@.@@.@..@@@@.@@@@@.@@.@@.@.@@@@@..@@.......@@@..@@..@@@@.@@@.@@..@.@@..@.@.@@@@.@@.@@.@@@@@.@@@@@.@
@.@..@.@@....@@@....@@.@@.@@@.@.@@..@.@@@@@@@.@@.@@@..@@@@@@@@..@@@.@@@.@@@.@@@@@.@@@..@@@.@@@@.@@.@@@@.@@@.@@@@@@@...@@...@.@.@@@..@@@.@@
.@@@@@@@@@@@.@@@..@@....@@.@@@@..@@@@@@.@@.@@@@.@@.@@.@@@..@@.@.@@@.@@@..@@.@@@@.@.@@@.@...@@..@@@.@@@.@@@@@@@@.@@....@@@@@@@@@@@.@..@.@@@
@@@..@@.@@@@.@@.@.@@@..@@..@.@.@@@@@..@@@@.@@@@@..@@@@@@@.@@.@@@..@@..@@@@@@@@@@@.@@@.@....@@@@@@...@@.@@......@@@..@@@@.@@..@.@@.@...@@@.
@.@@@..@@.@..@..@@@.@.@.@@@@@@@@.@@@@.@@..@@.@@@@...@@.@@@.@...@@@@.@@.@@@.@.@@@@@..@.@@.@.@@@.@.@@@@@.@@..@.@.@@@.@@..@..@.@@@@...@.@@@.@
@..@....@@@.@.@@@@@@@@@@@@@@.@...@@.@@.......@@@@@@@..@@.@@@@.@....@@.@@.@@.@@@..@@@.@@@@@@.@@.@...@@@@@..@.@@.@@@.@@..@@.@.@@..@@@@.....@
..@@@@@.@@@@@.@.@@..@@@@.@.@@..@.@@.@..@..@@.@@.@@..@@@..@@@@@.@@@....@@.@..@.@@.@@.@@..@@@@...@.@@@@@@@@@@.....@...@@.@@.@@@@@..@@.@@@.@@
@..@@@..@@@..@@.@.....@...@@@@@.@@@@.@.@..@.@.@.@.@@@..@@@.@@@.@@@.@@@@.@@@@@..@..@@@@.@@..@@.@@@..@@@@@.@..@..@.@@..@@@.@@@@@.@@@@.@@@..@
@..@@@.@.@@@.@@@.@@@@@.@@@.@@@@.......@.@...@..@@@.@..@@..@@..@@.@@@@@....@@.@@@@@..@.@@..@@...@@@@.@..@.@.@@@@....@.@.@.@@@...@.@@.@@@@..
..@@@@..@..@@@.@.@@@.@.@....@@@@.@@@@...@.@@@.@@@@.@@@@@@..@.@@..@@@@.@.......@@@.@@..@@@.@@@@@..@@@@.@.@.@@@..@@@..@@.@@@@@@@@@@..@@@.@..`.split('\n');

        let mode = 'part1';
        let animationSpeed = 600; // Default for speed 5
        let isRunning = false;
        let grid = [];
        let rows = 0;
        let cols = 0;

        function initGrid() {
            rows = PUZZLE_INPUT.length;
            cols = PUZZLE_INPUT[0].length;

            // Parse input into 2D array
            grid = PUZZLE_INPUT.map(line => line.split(''));

            // Update stats
            document.getElementById('gridSize').textContent = `${rows}√ó${cols}`;

            let totalRolls = 0;
            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    if (grid[r][c] === '@') totalRolls++;
                }
            }
            document.getElementById('totalRolls').textContent = totalRolls;

            renderGrid();
        }

        function renderGrid() {
            const gridContainer = document.getElementById('grid');
            gridContainer.innerHTML = '';
            gridContainer.style.gridTemplateColumns = `repeat(${cols}, 6px)`;

            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = r;
                    cell.dataset.col = c;

                    if (grid[r][c] === '@') {
                        cell.classList.add('roll');
                    } else {
                        cell.classList.add('empty');
                    }

                    gridContainer.appendChild(cell);
                }
            }
        }

        function countAdjacentRolls(r, c, currentGrid) {
            const directions = [
                [-1, -1], [-1, 0], [-1, 1],
                [0, -1],           [0, 1],
                [1, -1],  [1, 0],  [1, 1]
            ];

            let count = 0;
            for (const [dr, dc] of directions) {
                const nr = r + dr;
                const nc = c + dc;
                if (nr >= 0 && nr < rows && nc >= 0 && nc < cols) {
                    if (currentGrid[nr][nc] === '@') {
                        count++;
                    }
                }
            }
            return count;
        }

        function getCellElement(r, c) {
            return document.querySelector(`.cell[data-row="${r}"][data-col="${c}"]`);
        }

        function setMode(newMode) {
            mode = newMode;
            document.querySelectorAll('.mode-toggle button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            reset();
        }

        function reset() {
            isRunning = false;
            initGrid();
            document.getElementById('accessibleCount').textContent = '0';
            document.getElementById('totalRemoved').textContent = '0';
            document.getElementById('roundNumber').textContent = '-';
            document.getElementById('infoPanel').textContent = 'Click "Run Algorithm" to start visualization';
        }

        async function runAlgorithm() {
            if (isRunning) return;
            isRunning = true;

            if (mode === 'part1') {
                await runPart1();
            } else {
                await runPart2();
            }

            isRunning = false;
        }

        async function runPart1() {
            document.getElementById('infoPanel').textContent = 'Finding accessible rolls (< 4 adjacent rolls)...';

            let accessibleCount = 0;

            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    if (grid[r][c] === '@') {
                        const adjacent = countAdjacentRolls(r, c, grid);
                        if (adjacent < 4) {
                            const cell = getCellElement(r, c);
                            cell.classList.add('accessible');
                            accessibleCount++;
                            document.getElementById('accessibleCount').textContent = accessibleCount;
                            await sleep(animationSpeed / 100); // Fast highlight
                        }
                    }
                }
            }

            document.getElementById('infoPanel').textContent =
                `Found ${accessibleCount} accessible rolls (rolls with < 4 adjacent neighbors)`;
        }

        async function runPart2() {
            let totalRemoved = 0;
            let round = 0;
            let workingGrid = grid.map(row => [...row]);

            while (true) {
                round++;
                document.getElementById('roundNumber').textContent = round;
                document.getElementById('infoPanel').textContent = `Round ${round}: Finding accessible rolls...`;

                // Find accessible rolls
                const toRemove = [];
                for (let r = 0; r < rows; r++) {
                    for (let c = 0; c < cols; c++) {
                        if (workingGrid[r][c] === '@') {
                            const adjacent = countAdjacentRolls(r, c, workingGrid);
                            if (adjacent < 4) {
                                toRemove.push([r, c]);
                                const cell = getCellElement(r, c);
                                cell.classList.add('accessible');
                            }
                        }
                    }
                }

                if (toRemove.length === 0) {
                    document.getElementById('infoPanel').textContent =
                        `Complete! Removed ${totalRemoved} rolls over ${round - 1} rounds`;
                    break;
                }

                document.getElementById('accessibleCount').textContent = toRemove.length;
                document.getElementById('infoPanel').textContent =
                    `Round ${round}: Removing ${toRemove.length} accessible rolls...`;

                await sleep(animationSpeed);

                // Remove all accessible rolls simultaneously
                for (const [r, c] of toRemove) {
                    const cell = getCellElement(r, c);
                    cell.classList.remove('accessible');
                    cell.classList.add('removing');
                }

                await sleep(animationSpeed);

                for (const [r, c] of toRemove) {
                    workingGrid[r][c] = '.';
                    const cell = getCellElement(r, c);
                    cell.classList.remove('removing', 'roll');
                    cell.classList.add('removed', 'empty');
                    totalRemoved++;
                }

                document.getElementById('totalRemoved').textContent = totalRemoved;
                await sleep(animationSpeed / 2);
            }
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Speed slider
        document.getElementById('speedSlider').addEventListener('input', (e) => {
            const speed = parseInt(e.target.value);
            animationSpeed = 1100 - (speed * 100);
            document.getElementById('speedLabel').textContent = '‚óè'.repeat(speed);
        });

        // Initialize
        initGrid();
    </script>
</body>
</html>
